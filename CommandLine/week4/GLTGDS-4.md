---
title: "Command Line Tools for Genomic Data Science: Week 4"
---
## Module 4 Exam Instructions

> For this project, it is recommended that you use the VMBox virtual environment provided with the Course package and the tools therein. You may also use your own system and software, however make sure that appropriate versions are installed. The answers are compatible with the following versions of the software: samtools v.1.2, bowtie2 v.2.2.2, tophat v.2.0.14, and cufflinks/ cuffmerge/ cuffcompare/ cuffdiff v.2.2.1.

> You are performing an RNA-seq experiment to determine genes that are differentially expressed at different stages in the development of Arabidopsis thaliana shoot apical meristem. You collected samples at day 8 and day 16 (files “Day8.fastq” and “Day16.fastq”), extracted and sequenced the cellular mRNA, and are now set to perform the bioinformatics analysis. The reference genome you will need for the analysis is “athal_chr.fa” and the reference gene annotations are in “athal_genes.gtf”. Use default parameters unless otherwise specified. Sample command files that you can modify to create your own pipeline are provided in the file “commands.tar.gz”. All files are provided in the archive gencommand_proj4.tar.gz.

> [Click here to download the Project 3 Data Files][https://d396qusza40orc.cloudfront.net/gencommand/gencommand_proj4.tar.gz]

> Apply these rules and steps to the questions marked above each rule.

> NOTE: The genome and annotation data were obtained and modified from the Arabidopsis Information Resources (TAIR) Database, and the RNA-seq reads were extracted from GenBank’s Short Read Archive (SRA).

> Create a bowtie index of the genome using bowtie2-build, with the prefix ‘athal’. Include a copy of the reference genome with the name “athal.fa” in the index directory.

> **Questions 1 - 10:**

> Align both RNA-seq data sets to the reference genome using tophat. Analyze the results to answer the following questions. If multiple answers are required for one question, separate the answers with a space (e.g., 1000 2000).

> **Questions 11 - 20:**

> Assemble the aligned RNA-seq reads into genes and transcripts using cufflinks. Use the labels ‘Day8’ and ‘Day16’, respectively, when creating identifiers. For this portion of the analysis, answer the following questions.

> **Questions 21 - 30:**

> Run cuffcompare on the resulting cufflinks transcripts, using the reference gene annotations provided and selecting the option '-R' to consider only the reference transcripts that overlap some input transfrag. For this step, using the *.tmap files answer the following, for both sets.

> **Questions 31 - 35:**

> Perform the differential gene expression analysis. For this, in a first stage run cuffmerge using the provided annotation to merge and reconcile the two sets of cufflinks transcripts. Make a note of the resulting file, ‘merged.gtf’. In a second step, use cufdiff to perform the differential expression analysis.

> NOTE: Note that in general at least three replicates per condition are required to establish statistical significance. The single replicate example is provided here only to illustrate the analysis.

## Quiz

1. How many alignments were produced for the ‘Day8’ RNA-seq data set?

   `sh commands/com.tophat`after edit the commands file (see the attachments). 

   then

   `samtools view Tophat/Day8/accepted_hits.bam | cut -f7 | wc -l` and 

   `samtools view Tophat/Day16/accepted_hits.bam | cut -f7 | wc -l`

2. How many alignments were produced for the ‘Day16’ RNA-seq data set?

   *As shown above.*

3. How many reads were mapped in ‘Day8’ RNA-seq data set?

   `head Tophat/Day8/align_summary.txt`  and `head Tophat/Day16/align_summary.txt`

4. How many reads were mapped in ‘Day16’ RNA-seq data set?

   *As shown above.*

5. How many reads were uniquely aligned in ‘Day8’ RNA-seq data set?

   *As shown above.*

6. How many reads were uniquely aligned in ‘Day16’ RNA-seq data set?

   *As shown above.*

7. How many spliced alignments were reported for ‘Day8’ RNA-seq data set?

   `samtools view Tophat/Day8/accepted_hits.bam | cut -f6 | grep "N" | wc -l`

8. How many spliced alignments were reported for ‘Day16’ RNA-seq data set?

   `samtools view Tophat/Day16/accepted_hits.bam | cut -f6 | grep "N" | wc -l`

9. How many reads were left unmapped from ‘Day8’ RNA-seq data set?

   *As shown in question 3.*

10. How many reads were left unmapped from ‘Day16’ RNA-seq data set?

   *As shown in question 3.*

11. How many genes were generated by cufflinks for Day8?

   `sh commands/com.tophat`after edit the commands file (see the attachments).

   then

   `cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ";" -f1 | sort -u | wc -l`

12. How many genes were generated by cufflinks for Day16?

   `cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ";" -f1 | sort -u | wc -l`

13. How many transcripts were reported for Day8?

   `cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ";" -f2 | sort -u | wc -l`

14. How many transcripts were reported for Day16?

   `cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ";" -f2 | sort -u | wc -l`

15. How many single transcript genes were produced for Day8?

   `cat Cufflinks/Day8/transcripts.gtf | cut -f9 | cut -d ";" -f1,2 | uniq | cut -d ";" -f1 | uniq -c | awk '$1 == 1' | wc -l`

16. How many single transcript genes were produced for Day16?

   `cat Cufflinks/Day16/transcripts.gtf | cut -f9 | cut -d ";" -f1,2 | uniq | cut -d ";" -f1 | uniq -c | awk '$1 == 1' | wc -l`

17. How many single-exon transcripts were in the Day8 set?

   `cat Cufflinks/Day8/transcripts.gtf | cut -f9 | grep "exon_number" | cut -d ";" -f2,3 | cut -d ";" -f1 | uniq -c | awk '$1 == 1' | wc -l`

18. How many single-exon transcripts were in the Day16 set?

   `cat Cufflinks/Day16/transcripts.gtf | cut -f9 | grep "exon_number" | cut -d ";" -f2,3 | cut -d ";" -f1 | uniq -c | awk '$1 == 1' | wc -l`

19. How many multi-exon transcripts were in the Day8 set?

   `cat Cufflinks/Day8/transcripts.gtf | cut -f9 | grep "exon_number" | cut -d ";" -f2,3 | cut -d ";" -f1 | uniq -c | awk '$1 > 1' | wc -l`

20. How many multi-exon transcripts were in the Day16 set?

   ` cat Cufflinks/Day16/transcripts.gtf | cut -f9 | grep "exon_number" | cut -d ";" -f2,3 | cut -d ";" -f1 | uniq -c | awk '$1 > 1' | wc -l`

21. How many cufflinks transcripts fully reconstruct annotation transcripts in Day8?

   `sh commands/com.cuffcompare`after edit the commands file (see the attachments).

   then

   `cat Cufflinks/Day8/Day8.transcripts.gtf.tmap | cut -f3 | grep "=" | wc -l`

22. How many cufflinks transcripts fully reconstruct annotation transcripts in Day16?

   `cat Cufflinks/Day16/Day16.transcripts.gtf.tmap | cut -f3 | grep "=" | wc -l`

23. How many splice variants does the gene AT4G20240 have in the Day8 sample?

   `cat Cufflinks/Day8/Day8.transcripts.gtf.tmap | grep "AT4G20240" | wc -l`

24. How many splice variants does the gene AT4G20240 have in the Day16 sample?

   `cat Cufflinks/Day16/Day16.transcripts.gtf.tmap | grep "AT4G20240" | wc -l`

25. How many cufflinks transcripts are partial reconstructions of reference transcripts (‘contained’)? (Day8)

   `cat Cufflinks/Day8/Day8.transcripts.gtf.tmap | cut -f3 | grep "c" | wc -l`

26. How many cufflinks transcripts are partial reconstructions of reference transcripts (‘contained’)? (Day16)

   `cat Cufflinks/Day16/Day16.transcripts.gtf.tmap | cut -f3 | grep "c" | wc -l`

27. How many cufflinks transcripts are novel splice variants of reference genes? (Day8)

   `cat Cufflinks/Day8/Day8.transcripts.gtf.tmap | cut -f3 | grep "j" | wc -l`

28. How many cufflinks transcripts are novel splice variants of reference genes? (Day16)

   `cat Cufflinks/Day16/Day16.transcripts.gtf.tmap | cut -f3 | grep "j" | wc -l`

29. How many cufflinks transcripts were formed in the introns of reference genes? (Day8)

   `cat Cufflinks/Day8/Day8.transcripts.gtf.tmap | cut -f3 | grep "i" | wc -l`

30. How many cufflinks transcripts were formed in the introns of reference genes? (Day16)

   `cat Cufflinks/Day16/Day16.transcripts.gtf.tmap | cut -f3 | grep "i" | wc -l`

31. How many genes (loci) were reported in the merged.gtf file?

   `sh commands/com.cuffdiff` after edit the commands file (see the attachments).

   then

   `cat Cuffmerge/merged.gtf | cut -f9 | cut -d ";" -f1 | sort -u | wc -l`

32. How many transcripts?

   `cat Cuffmerge/merged.gtf | cut -f9 | cut -d ";" -f2 | sort -u | wc -l`

33. How many genes total were included in the gene expression report from cuffdiff?

   `cat Cuffdiff/gene_exp.diff | cut -f2 | sort -u | wc -l`

34. How many genes were detected as differentially expressed?

   `cat Cuffdiff/gene_exp.diff | cut -f14 | grep "yes" | wc -l`

35. How many transcripts were differentially expressed between the two samples?

   `cat Cuffdiff/isoform_exp.diff | cut -f14 | grep "yes" | wc -l`



The END.
