---
title: "Command Line Tools for Genomic Data Science: Week 3"
---
## Module 3 Exam Instructions

> For this project, it is recommended that you use the VMBox virtual environment provided with the Course package and the tools therein. You may also use your own system and software, however make sure that appropriate versions are installed. The answers are compatible with the following versions of the software: samtools v.1.2, bowtie v.2.2.5 and bcftools v.1.2.

> As part of the effort to catalog genetic variation in the plant Arabidopsis thaliana, you re-sequenced the genome of one strain (‘wu\_0\_A’; genome file: ‘wu\_0.v7.fas’), to determine genetic variants in this organism. The sequencing reads produced are in the file ‘wu\_0\_A_wgs.fastq’. Using the tools bowtie2, samtools and bcftools, develop a pipeline for variant calling in this genome. NOTE: Genome and re-sequencing data have been obtained and modified from those generated by the 1001 Genomes Project, accession ‘Wu\_0\_A’.

> [Click here to download the Project 3 Data Files][https://d396qusza40orc.cloudfront.net/gencommand/gencommand_proj3_data.tar.gz]

> Apply these rules and steps to the questions marked above each rule.

> **Questions 1 - 5:**

> Generate a bowtie2 index of the wu_0_A genome using bowtie2-build, with the prefix 'wu\_0'.

> **Questions 6 - 14:**

> Run bowtie2 to align the reads to the genome, under two scenarios: first, to report only full-length matches of the reads; and second, to allow partial (local) matches. All other parameters are as set by default.

> **For the following set of questions (11 - 20), use the set of full-length alignments calculated under scenario 1 only. Convert this SAM file to BAM, then sort the resulting BAM file.**

> **Questions 15 - 19:**

> Compile candidate sites of variation using SAMtools mpileup for further evaluation with BCFtools. Provide the reference fasta genome and use the option “-uv” to generate the output in uncompressed VCF format for easy examination.

> **Questions 20 - 24:**

> Call variants using ‘BCFtools call’ with the multiallelic-caller model. For this, you will need to first re-run SAMtools mpileup with the BCF output format option (‘-g’) to generate the set of candidate sites to be evaluated by BCFtools. In the output to BCFtools, select to show only the variant sites, in uncompressed VCF format for easy examination.

## Quiz

1. How many sequences were in the genome?

   `cat wu_0.v7.fas | grep ">" | wc -l`

2. What was the name of the third sequence in the genome file? Give the name only, without the “>” sign.

   `cat wu_0.v7.fas | grep ">" | head`

3. What was the name of the last sequence in the genome file? Give the name only, without the “>” sign.

   `cat wu_0.v7.fas | grep ">" | head`

4. How many index files did the operation create?

   `mkdir wu_0` then `bowtie2-bulid wu_0.v7.fas wu_0/wu_0` then `ls wu_0 | wc -l`

5. What is the 3-character extension for the index files created?

   `mkdir wu_0` then `bowtie2-bulid wu_0.v7.fas wu_0/wu_0` then `ls wu_0`

6. How many reads were in the original fastq file?

   First:

   `bowtie2 -p 4 -x wu_0/wu_0 wu_0_A_wgs.fastq -S wu_0.bt2.sam`

   Result:

   ```
   147354 reads; of these:
   	147354 (100.00%) were unpaired; of these:
   		9636 (6.54%) aligned 0 times
   		93780 (63.64%) aligned exactly 1 time
   		43938 (29.82%) aligned >1 times
   93.46% overall alignment rate
   ```

   Then:

   `bowtie2 -p 4 --local -x wu_0/wu_0 wu_0_A_wgs.fastq -S wu_0.bt2.local.sam`

   Result:

   ```
   147354 reads; of these:
    	147354 (100.00%) were unpaired; of these:
       	6315 (4.29%) aligned 0 times
       	84939 (57.64%) aligned exactly 1 time
       	56100 (38.07%) aligned >1 times
   95.71% overall alignment rate
   ```

7. How many matches (alignments) were reported for the original (full-match) setting? Exclude lines in the file containing unmapped reads.

   *As shown above.*

8. How many matches (alignments) were reported with the local-match setting? Exclude lines in the file containing unmapped reads.

   *As shown above.*

9. How many reads were mapped in the scenario in Question 7?

   *As shown above.*

10. How many reads were mapped in the scenario in Question 8?

   *As shown above.*

11. How many reads had multiple matches in the scenario in Question 7? You can find this in the bowtie2 summary; note that by default bowtie2 only reports the best match for each read.

   *As shown above.*

12. How many reads had multiple matches in the scenario in Question 8? Use the format above. You can find this in the bowtie2 summary; note that by default bowtie2 only reports the best match for each read.

   *As shown above.*

13. How many alignments contained insertions and/or deletions, in the scenario in Question 7?

   `cat wu_0.bt2.sam | cut -f6 | grep "I" | wc -l` get the result `1429`

   then

   `cat wu_0.bt2.sam | cut -f6 | grep "D" | wc -l` get the result `1395`

   then 

   `cat wu_0.bt2.sam | cut -f6 | grep "I" | grep "D" | wc -l` get the result `42`

   so `1429+1395-42=2782`

14. How many alignments contained insertions and/or deletions, in the scenario in Question 8?

   change the `wu_0.bt2.sam` to `wi_0.bt2.local.sam` then get the result `2614`

15. How many entries were reported for Chr3?

   `samtools view -bT wu_0.v7.fas wu_0.bt2.sam > wu_0.bt2.bam` then

   `samtools sort wu_0.bt2.bam -o wu_0.bt2.sorted.bam` then

   `samtools index wu_0.bt2.sorted.bam` then

   `samtools mpileup -f wu_0.v7.fas wu_0.bt2.sorted.bam > wu_0.mpileup` then

   `samtools mpileup -uv -f wu_0.v7.fas wu_0.bt2.sorted.bam > wu_0.vcf` then

   `cat wu_0.vcf | cut -f1 | grep "Chr3" | wc -l` get the result `360296`

   the unmber above include the header, so the answer is `360296 - 1 = 360295`

16. How many entries have ‘A’ as the corresponding genome letter?

   `cat wu_0.vcf | cut -f4 | awk '$1 == "A"' | wc -l`

17. How many entries have exactly 20 supporting reads (read depth)?

   `cat wu_0.vcf | cut -f8 | grep "DP=20" | wc -l`

18. How many entries represent indels?

   `cat wu_0.vcf | cut -f8 | grep "INDEL" | wc -l` then 

   the result need to minus 1 cause the header was included.

19. How many entries are reported for position 175672 on Chr1?

   `cat wu_0.vcf | cut -f1,2 | grep "Chr1" | awk '$2 == "175672"' | wc -l`

20. How many variants are called on Chr3?

   `samtools mpileup -g -f wu_0.v7.fas wu_0.bt2.sorted.bam > wu_0.bcf` then

   `bcftools call -v -m -O z -o wu_0.vcf.gz wu_0.bcf` then

   `zcat wu_0.vcf.gz | cut -f1 | grep "Chr3" | wc -l`

   someone got the result `399` and minus 1 for the header situation.

   Although I can't get the result anyway.

21. How many variants represent an A->T SNP? If useful, you can use ‘grep –P’ to allow tabular spaces in the search term.

   `zcat wu_0.vcf.gz | cut -f4,5 | awk '$1 == "A" && $2 == "T"' | wc -l` . As above.

22. How many entries are indels?

   `zcat wu_0.vcf.gz | cut -f8 | grep "INDEL" | wc -l`. As above.

23. How many entries have precisely 20 supporting reads (read depth)?

   `zcat wu_0.vcf.gz | cut -f8 | grep "DP=20" | wc -l`. As above.

24. What type of variant (i.e., SNP or INDEL) is called at position 11937923 on Chr3?

   `cat wu_0.vcf | grep -v "^#" | cut -f1-5 | grep Chr3 | grep 11937923`





The END.
